---
name: pdd-skill1_8-proto2planning
description: "整理清晰新增的业务逻辑与实现规则，补充完整原子任务内容。在每个原子任务中补充精炼的业务逻辑描述和实现规则，并包含几个模拟真实场景的规则示例。"
---

# Skill 1_8：补充原子任务内容

## 概述

- **所属阶段**：S2「原型评审 / 落地规划」
- **目标**：基于已有的原子任务列表（来自 `pdd-skill1_7-proto2planning`），整理清晰的新增业务逻辑与实现规则，补充完整任务内容，要求内容精炼，并在每个原子任务中写几个模拟真实场景的规则。
- **执行者**：Cursor（Business Logic Analyst & Rule Designer）
- **输入**：
  - 原子任务列表（来自 `pdd-skill1_7-proto2planning` 的输出）
  - 任务编号或任务组（如 `任务A1` 或 `任务组A`）
- **输出**：
  - 补充完整的原子任务内容
  - 每个任务包含：详细的业务逻辑描述、完整的实现规则、真实场景规则示例

---

## 定位与与其它 Skills 的关系

- **前置 Skill**：`pdd-skill1_7-proto2planning`（需要先有原子任务列表）
- **后续 Skill**：
  - `pdd-skill1_9-proto2planning`：基于补充完整的原子任务，生成完整的原型实现规划文档

> **重要心态**：本 Skill 专注于「补充」和「细化」，将原子任务从「要点」扩展为「完整规则」，但不涉及具体代码实现。

---

## 触发方式

- **推荐触发关键词**：
  - `@pdd-skill1_8-proto2planning`
  - `@pdd-supplement-tasks`
  - `@补充任务内容`

- **示例 1：补充单个任务**

> `@pdd-skill1_8-proto2planning 整理清晰新增的业务逻辑与实现规则，补充完整 [任务A1] 中的内容，要求内容精炼，并在每个原子业务中写几个模拟真实场景的规则。`

- **示例 2：补充整个任务组**

> `@pdd-skill1_8-proto2planning 补充完整 [任务组A] 中所有任务的内容，包括业务逻辑、实现规则和真实场景示例。`

- **示例 3：指定任务编号**

> `@pdd-skill1_8-proto2planning 任务A1，补充完整内容。`

---

## Skill 内部工作流

> **角色**：Business Logic Analyst & Rule Designer  
> **目标**：将原子任务的「要点」扩展为「完整规则」，包含真实场景示例。

### 步骤 1：定位目标任务（Task Location）

1. **读取原子任务列表**：
   - 查找用户指定的任务编号或任务组
   - 确认任务的存在和上下文

2. **理解任务上下文**：
   - 查看任务所在的任务组
   - 查看前后相关任务
   - 理解任务在整个功能模块中的位置

### 步骤 2：分析业务逻辑（Business Logic Analysis）

对每个目标任务，深入分析：

1. **业务场景识别**：
   - 该任务解决什么业务问题？
   - 在什么情况下会触发？
   - 涉及哪些角色或实体？

2. **数据流向分析**：
   - 输入数据来源
   - 数据处理过程
   - 输出数据去向

3. **状态变化分析**：
   - 前置状态
   - 执行后的状态
   - 异常状态

### 步骤 3：整理实现规则（Implementation Rules Organization）

将实现规则按以下维度整理：

1. **数据规则**：
   - 数据结构要求
   - 数据验证规则
   - 数据转换规则
   - 数据一致性规则

2. **业务规则**：
   - 业务判断条件
   - 业务流程规则
   - 业务约束规则
   - 业务异常处理规则

3. **交互规则**：
   - 用户操作规则
   - UI 反馈规则
   - 确认流程规则
   - 错误提示规则

4. **技术规则**：
   - API 调用规则
   - 缓存规则
   - 性能规则
   - 安全规则

### 步骤 4：设计真实场景规则（Real Scenario Rules）

为每个任务设计 3-5 个真实场景规则，每个场景包含：

1. **场景描述**：
   - 场景名称
   - 场景背景（什么情况下发生）
   - 场景触发条件

2. **规则定义**：
   - 输入条件
   - 处理规则
   - 输出结果
   - 异常处理

3. **示例格式**：

   ```markdown
   **场景 X：<场景名称>**
   - **触发条件**：<什么情况下触发>
   - **输入数据**：<输入的数据格式和内容>
   - **处理规则**：<系统如何处理>
   - **输出结果**：<期望的输出>
   - **异常情况**：<可能的异常及处理方式>
   ```

### 步骤 5：补充完整任务内容（Complete Task Content）

将分析结果整理成完整的任务内容：

```markdown
### 任务 X1：<任务名称>

**业务逻辑描述**：
<详细描述该任务的业务逻辑，包括：
  - 要解决什么问题
  - 在什么场景下使用
  - 涉及哪些实体和关系
  - 预期的业务效果>

**实现规则**：

**1. 数据规则**
  - <规则1>
  - <规则2>

**2. 业务规则**
  - <规则1>
  - <规则2>

**3. 交互规则**
  - <规则1>
  - <规则2>

**4. 技术规则**
  - <规则1>
  - <规则2>

**真实场景规则示例**：

**场景 1：<场景名称>**
  - **触发条件**：<条件>
  - **输入数据**：<数据>
  - **处理规则**：<规则>
  - **输出结果**：<结果>
  - **异常情况**：<异常>

**场景 2：<场景名称>**
  ...
```


---

## 输出格式约定

1. **内容精炼要求**：
   - 业务逻辑描述：100-200 字，清晰准确
   - 实现规则：每条规则一句话，避免冗长
   - 场景规则：每个场景 50-100 字，突出关键点

2. **规则分类**：
   - 必须按照「数据规则」「业务规则」「交互规则」「技术规则」分类
   - 每个分类下至少 2 条规则

3. **场景数量**：
   - 每个任务至少 3 个真实场景
   - 场景应覆盖正常流程、边界情况、异常情况

4. **不包含内容**：
   - 不包含具体代码实现
   - 不包含详细的 API 接口定义
   - 不包含 UI 设计细节

---

## 最佳实践与使用建议

- **何时使用本 Skill**：
  - 在原子任务列表生成后，需要补充详细规则时
  - 在生成原型设计文档前，需要明确实现规则时
  - 在代码评审前，需要梳理业务规则时

- **如何迭代**：
  - 可以针对单个任务多次补充
  - 可以针对整个任务组批量补充
  - 可以根据反馈调整规则和场景

- **如何与其它 Skill 协作**：
  - 完成后，使用 `pdd-skill1_9-proto2planning` 生成完整的原型实现规划
  - 在实现阶段，可以参考这些规则进行开发

---

## 示例输出

```markdown
### 任务 A1：定义版本映射表数据结构

**业务逻辑描述**：
版本映射表用于存储菜单和按钮权限在不同版本下的配置信息（如组件路径、API URL）。每个菜单项或按钮权限可以有多个版本的映射记录，通过菜单ID和版本号唯一标识。该数据结构是版本化系统的核心基础，支持菜单和按钮权限的版本管理和切换。

**实现规则**：

**1. 数据规则**
- 版本号格式：`版本X.Y`（如 `版本1.0`、`版本2.1`），主版本号和小版本号均为非负整数
- 菜单ID与版本号组合唯一，同一菜单在同一版本下只能有一条映射记录
- 支持两种类型：菜单（type=1）和按钮权限（type=2）
- 菜单类型必须包含 `componentPath` 字段，按钮权限类型必须包含 `apiUrl` 字段

**2. 业务规则**
- 创建新版本映射时，必须基于已存在的版本（基础版本）
- 删除版本时，如果该版本是当前租户的激活版本，需要自动切换到其他可用版本
- 版本号必须按语义化版本规则递增（主版本号或小版本号增加）

**3. 交互规则**
- 在版本配置对话框中，显示该菜单项的所有版本映射
- 支持新增小版本（如 1.0 → 1.1）和大版本（如 1.0 → 2.0）
- 编辑版本映射时，只能修改组件路径或 API URL，不能修改版本号

**4. 技术规则**
- 版本号存储时需标准化（`版本1` → `版本1.0`）
- 查询时支持版本号的模糊匹配和精确匹配
- 版本映射表与菜单表通过菜单ID关联，需保持数据一致性

**真实场景规则示例**：

**场景 1：新增菜单的小版本映射**
- **触发条件**：用户在菜单版本配置对话框中点击「新增小版本」按钮
- **输入数据**：菜单ID=`2`，当前最大版本=`版本1.0`，基础组件路径=`system/user/v1.0/index`
- **处理规则**：系统自动生成新版本号 `版本1.1`，基于 `版本1.0` 的配置创建新映射，组件路径更新为 `system/user/v1.1/index`
- **输出结果**：创建成功，返回新版本映射记录，版本配置对话框刷新显示
- **异常情况**：如果 `版本1.1` 已存在，提示「该版本已存在」，不允许重复创建

**场景 2：删除当前激活版本**
- **触发条件**：用户删除版本映射，且该版本是当前租户的激活版本（如 `版本2.0`）
- **输入数据**：版本号=`版本2.0`，当前租户激活版本=`版本2.0`
- **处理规则**：系统先删除该版本的所有映射记录，然后自动切换到上一个可用版本（如 `版本1.1`），更新租户配置和菜单表
- **输出结果**：删除成功，系统自动切换到 `版本1.1`，提示「版本已删除，已自动切换到版本1.1」
- **异常情况**：如果没有其他可用版本，提示「无法删除，至少保留一个版本」

**场景 3：查询菜单的所有版本映射**
- **触发条件**：用户打开菜单版本配置对话框，或系统需要加载菜单的版本信息
- **输入数据**：菜单ID=`2`
- **处理规则**：系统查询版本映射表中所有 `menuId=2` 的记录，按版本号升序排序返回
- **输出结果**：返回版本列表 `[版本1.0, 版本1.1, 版本2.0]` 及对应的组件路径
- **异常情况**：如果菜单ID不存在或没有版本映射，返回空数组，UI 显示「暂无版本数据」
```
