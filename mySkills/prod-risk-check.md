# 生产前易错问题检查 Skill（怀疑点 → 循环依赖排查）

## Skill 目的

- 当你**怀疑某个功能在生产环境表现异常**时，帮助你判断：  
  这个问题是否可能与“模块循环依赖 / 初始化顺序差异”有关（不限入口文件、不限全局属性）。

## 如何触发（对 Cursor 说）

- 推荐用法：
  - `@prod-risk 某某功能在生产环境异常，帮我看一下是否可能和循环依赖有关`
  - `@prod-risk 这个权限按钮在生产不显示，分析一下是不是循环依赖 / 初始化顺序问题`

> Skill 本身只做**分析和定位**，不直接修改代码。

## 分析步骤（只读）

### 1. 收集怀疑功能的上下文

- 识别该功能涉及的：
  - 组件 / 视图文件路径；
  - 直接依赖的模块（API、store 模块、service、全局属性等）。
- 目标：圈定“相关模块子图”，避免全仓库乱扫。

### 2. 检查相关模块的 import 图

- 在这些相关模块中（包含它们的上游依赖）：
  - 用 `grep` / 代码搜索，列出它们 import / 被 import 的关系；
  - 尤其关注：
    - 是否互相 import（A import B，B 又 import A）；
    - 是否依赖入口文件（如 `@/main`）或核心聚合模块（如总的 `store/index`、`router/index`）。

### 3. 判断是否构成高风险循环依赖

- 如果存在以下任一模式，可标记为“疑似循环依赖风险”：
  - 功能相关模块之间互相 import；
  - 功能模块 import 入口文件，而入口文件又间接依赖该模块；
  - 功能模块依赖的 service / 工具模块，再反向依赖 store/router/main。
- 对每个命中点，只需给出：
  - 参与循环的文件路径列表；
  - 一个简短的风险说明（例如：“初始化顺序可能不稳定，开发 / 生产行为可能不一致”）。

### 4. 结合 currentDepartment 案例给出建议

- 与 `.cursor/skills/todolist/高风险问题-currentDepartment-循环依赖.md` 对照，判断是否属于同类问题：  
  - 有无“入口 ↔ store”闭环；  
  - 有无通过全局属性或存储恢复的“伪状态”。  
- 若是同类：
  - 建议参考 currentDepartment 的解法：抽独立 service、断开入口与业务模块之间的环形依赖。

## 输出要求

- 只给**结果摘要**，不贴具体代码行：
  - 涉及的文件/模块名；
  - 是否发现明显循环依赖；  
  - 若有，简单描述风险和建议重构方向。  
- 如需真正修改代码，由你再明确下一个指令（例如“现在开始帮我拆这个循环依赖”）。


