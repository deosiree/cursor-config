# CSV词条批量翻译Skill

## 功能概述

批量翻译CSV文件中的词条，只修改英文翻译列，不修改中文。如果中文不规范，在"备注1"列记录不规范现象。

## 触发方式

```
@trans-skill1-loader [输入csv文件的相对路径] [输出csv目录的相对路径] [excel术语库的相对路径]
```

**示例**：
```
@trans-skill1-loader f:\DownLoads\词条导出_20260128111948.csv .cursor/skills/translate/output .cursor/skills/translate/glossary/常用注意要点清单.xlsx
```

## 输入参数

1. **输入CSV文件路径**（相对路径或绝对路径）
   - 包含需要翻译的词条
   - 列结构：`id,词条,英文翻译,comment,俄文翻译,备注,翻译最大长度`

2. **输出CSV目录路径**（相对路径或绝对路径）
   - 翻译后的CSV文件将输出到此目录
   - 输出文件名与输入文件名相同

3. **Excel术语库文件路径**（相对路径或绝对路径，可选）
   - 默认：`.cursor/skills/translate/glossary/常用注意要点清单.xlsx`
   - 如果translation-rules.md不存在，将从此Excel提取术语库

## 处理流程

### 步骤1: 术语库提取（如果需要）
- 检查`translation-rules.md`是否存在
- 如果不存在，从Excel提取术语库并生成规则文档

### 步骤2: 加载翻译规则
- 读取`translation-rules.md`文件
- 解析markdown表格，构建两个映射表：
  - `abbreviationMap`: `{中文: 英文缩写}`
  - `fullTranslationMap`: `{中文: 完整英文}`

### 步骤3: 批量读取CSV文件
- 使用CSV解析器读取文件
- 识别列结构
- 提取所有词条行（跳过空行和标题行）

### 步骤4: AI翻译每个词条
- 对每个词条调用AI翻译
- 识别并保护占位符（`{}`, `{:.3f}`, `%1`, `%2`等）
- 优先使用术语库中的缩写

### 步骤5: 中文规范性检查
- 检查中文词条是否规范
- 如果发现不规范，在"备注1"列记录不规范现象
- 格式：`[不规范类型]: [具体描述]`

### 步骤6: 翻译结果验证和后处理
- 验证占位符是否被保护
- 验证术语库使用情况
- 修正标点符号（中文标点→英文标点）
- 如果验证失败，在"备注1"列追加错误信息

### 步骤7: 写入输出CSV文件
- 构建输出CSV结构（原有列 + 备注1列）
- 保持原有列的值不变（除了"英文翻译"列）
- 更新"英文翻译"列
- 写入"备注1"列（如有）
- 使用UTF-8 BOM编码

### 步骤8: 记录错误日志
- 记录翻译失败的词条
- 记录中文不规范的词条
- 记录验证失败的词条
- 生成统计信息

## 输出

- **翻译后的CSV文件**（UTF-8 BOM编码）
  - 路径：`[输出目录]/[输入文件名]`
  - 包含翻译后的英文翻译列和备注1列（如有）

- **错误日志文件**（如有错误）
  - 路径：`[输出目录]/[输入文件名]_errors.log`
  - 包含详细的错误信息和统计

## 注意事项

- **只修改"英文翻译"列**：其他列保持不变
- **不修改中文**：中文词条列保持不变
- **中文不规范处理**：在"备注1"列记录，不修改中文本身
- **占位符保护**：保持占位符不变
- **术语库优先级**：优先使用术语库中的缩写
- **批量处理**：支持一次性处理整个CSV文件
- **错误处理**：所有错误都记录到日志文件，不影响主流程

## 使用示例

### 示例1: 使用默认术语库
```
@trans-skill1-loader f:\DownLoads\词条导出_20260128111948.csv .cursor/skills/translate/output
```

### 示例2: 指定术语库路径
```
@trans-skill1-loader f:\DownLoads\词条导出_20260128111948.csv .cursor/skills/translate/output .cursor/skills/translate/glossary/常用注意要点清单.xlsx
```

## 实现说明

此skill通过调用`translateCsv.js`脚本实现所有功能。脚本集成以下模块：

1. **术语库提取模块**：从Excel提取术语库
2. **翻译规则加载模块**：加载并解析翻译规则
3. **CSV处理模块**：读取和写入CSV文件
4. **AI翻译模块**：调用AI进行翻译
5. **中文验证模块**：检查中文规范性
6. **翻译验证模块**：验证翻译结果
7. **错误日志模块**：记录错误和统计信息
