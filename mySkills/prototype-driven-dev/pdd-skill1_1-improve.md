# Skill 1-Improve：pdd-skill1_1-improve（原型迭代闭环：改代码 + 回写需求）

## 概述

- **所属阶段**：S1「设计 / 极速原型」的“迭代闭环增强”
- **目标**：在不改动业务源码的前提下，基于一份“原型设计需求”持续迭代原型代码，并**同步把真实落地后的关键决策/约束/交互细节回写到需求文档**，让需求越来越可执行、可复用、可追溯。
- **适用场景**：
  - 你在做原型时不断补充新细节（比如“在某个 dataType 下增加子 Tab”“保留原有表单项但拆分状态”“路由入口需要按钮打开模态框”）
  - 需求最初写得很粗，需要边做边补
  - 希望把这套“原型实现 + 需求沉淀”的做法固化成可重复的工作流

## 触发方式

- **自然语言触发（推荐）**：
  - 任何以 `@pdd-skill1_1-improve` 开头的对话，后面跟一段中文/英文描述，均视为一次“设计需求补充”，例如：
    - `@pdd-skill1_1-improve 修改图1的样式为图2，要求tab页一行，tab页下的内容一行，是垂直结构而不是水平结构`
    - `@pdd-skill1_1-improve 把配置文件 Tab 的 JSON 页也加上搜索和全选`
  - 在这种用法下：
    - 若描述中**未指定其它需求文件**，则默认 **基于并回写**：`.cursor/skills/prototype-driven-dev/原型设计需求.md`
    - 若描述中包含明确的文件路径（如：`.cursor/skills/prototype-driven-dev/原型设计需求.md`），则优先使用该文件作为“本次迭代的设计需求源”。

- **显式传入需求块（可选）**：
  - `@pdd-skill1_1-improve [设计需求]`
  - `[设计需求]` 支持：
    - 直接粘贴一段需求文本（将被视为对默认需求的覆盖/追加说明）
    - 或传入一个文件路径（相对仓库根路径），例如：`.cursor/skills/prototype-driven-dev/原型设计需求.md`

## 强制约束（最重要）

- **必须先读需求再动代码**（硬约束）：
  - 每次执行本 Skill 时，**第一步必须读取当前的“设计需求源”文件/文本，并在内部梳理出“本次要改进的需求点”**（可以是样式、交互、数据结构、路由入口等）。
  - 禁止在未明确需求或未更新需求文档的情况下，直接修改 prototype 代码。
  - 对于用户通过自然语言追加的改动（例如“把样式从水平改为垂直结构”），在完成代码修改后，**必须把这一点以文字形式同步回写到设计需求文档**。
- **禁止修改**任何被“参考/对照/拷贝来源”的现有业务页面/组件（如 `src/views/workbench/importModal.vue`）。
  - 若需要“整组件拷贝后改造”，必须复制到 `prototype/<feature-key>/` 下再改（例如 `prototype/importConfig/ImportModalPrototype.vue`）。
- **原型必须可访问**：通过静态路由 `/translate/...` 可直接打开体验。
- **风格统一（本项目约定）**：
  - 原型 Vue 组件默认使用 **`.vue + <script> + JavaScript（Options API）`**，对齐 `src/views` 的代码风格。
  - 只有用户明确要求时才使用 TypeScript；并尽量限制在 prototype 目录、且避免引入额外 TS 依赖。

## 输入 / 输出

### 输入

- **设计需求**（默认：`.cursor/skills/prototype-driven-dev/原型设计需求.md`）
- （可选）原型入口页面/参考业务组件路径（若需求中未写清）

### 输出

- **代码变更**：完成原型迭代（新增/调整 `prototype/**`，必要时调整 `prototype/router.js` 与原型入口页）
- **需求回写**：更新设计需求文件（默认是 `.cursor/skills/prototype-driven-dev/原型设计需求.md`）
- **规则补强（可选）**：若本次迭代暴露了 Skill 规则缺口，更新 `.cursor/skills/prototype-driven-dev/pdd-skill1-prototype.md`

## 工作流（执行步骤）

> 目标：每次迭代都形成“可跑的原型 + 更清晰的需求”。

1. **读取需求**
   - 读取默认需求文件：`.cursor/skills/prototype-driven-dev/原型设计需求.md`
   - 若用户传入了 `[设计需求]`：
     - 若是路径：读取该文件
     - 若是文本：直接作为需求源（并可选择回写到默认需求文件）

2. **对齐现状**
   - 查找当前原型入口路由（`prototype/router.js` + `src/router/index.js` 的 prototypeRoutes 导入）
   - 找到当前 prototype 目录下与需求对应的 feature 目录（例如 `prototype/importConfig/`）
   - 快速确认：现状与需求差距（UI/交互/状态/数据流）

3. **实现迭代（改代码）**
   - 只在 `prototype/<feature-key>/` 内增删改文件
   - 优先复用现有组件库（Ant Design Vue）
   - 原型数据用 `MOCK_DATA` + `setTimeout(800ms)` 模拟异步，不写真实 API 调用（除非需求明确要复用业务组件内部逻辑）

4. **同步回写（改需求）**
   - 把本次迭代中“新增/变更的需求事实”写回需求文档，包括：
     - 改造位置（精确到文件 + 区块，例如 `dataType === 'config'`）
     - UI 结构（Tab、按钮、字段等）
     - 状态策略（例如 Tab 间独立选中/搜索值、切换不丢失）
     - 关键约束（例如“不改业务文件，必须拷贝到 prototype 后修改”）
   - 需求文档要做到“下次读的人只看需求就能复现原型”，避免只写一句话/引用行号但缺少交互细节。

5. **规则补强（必要时）**
   - 如果本次迭代暴露了 `pdd-skill1-prototype.md` 中未覆盖的约束或最佳实践（比如“项目风格统一用 JS/Options API”），则同步更新该 Skill 规则。

## 需求回写规范（建议）

- 使用明确结构：
  - **改造目标**
  - **改造位置**
  - **UI 结构**
  - **交互与状态**
  - **Mock 策略/数据结构**
  - **验收路径（URL + 点击路径）**
- 避免只写“参考某行”，应该补上“为什么”“怎么交互”“状态如何分离”。

## 示例

### 示例：默认读取需求文件

`@pdd-skill1_1-improve`

### 示例：传入一段新需求（覆盖/追加）

`@pdd-skill1_1-improve 在导入模态框的“配置文件”里增加 XML/JSON 子 Tab，两个 Tab 内容都还是“配置文件：”，但各自保持独立的已选项与搜索关键字。`

---

> 备注：本 Skill 的核心价值是把“临时口头需求 → 可复用文档需求”的过程固化下来，避免原型越做越难维护、需求越改越说不清。

