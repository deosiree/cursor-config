## 生产环境易错问题检查清单（按问题类型分组，持续补充）

### 1. 全局属性 / 初始化顺序相关

- **1.1 currentDepartment 全局属性循环依赖（已修复，可作为模板）**
  - **风险类型**：入口文件与 store 之间的循环依赖，导致全局属性在生产环境初始化顺序错乱。
  - **典型现象**：开发环境正常，生产环境中依赖 `$currentDepartment.ops.has(...)` 的功能入口（如“工具箱”“回写”按钮）消失或被误判为无权限。
  - **关键成因**：`main` 中创建 `app` 并导出设置全局属性的方法，`store` 反向 import 该方法 → 形成 `main ↔ store` 闭环，构建后 `store` 可能在 `app` 初始化前就调用写入逻辑，导致 `$currentDepartment` 维持 `null` 或未正确恢复。
  - **快速检查**：
    - 搜索是否存在从 `@/main` 导入的函数被 `src/store/` 或其他核心模块调用。
    - 检查全局属性（如 `$currentDepartment`）的设置逻辑是否放在入口文件中，并被业务模块反向依赖。
    - 确认是否已使用独立的 service 模块（如 `src/services/currentDepartmentService.js`）承载“全局属性 + 持久化”的逻辑，并保证 service 不依赖 `main/store/router`。
  - **详细说明与修复方案参考**：见 `.cursor/skills/todolist/高风险问题-currentDepartment-循环依赖.md`。

